<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verifyr Chat - Health-Tech Product Assistant</title>

    <!-- SEO Meta Tags -->
    <meta name="description" content="Chat with Verifyr's AI assistant to compare Health-Tech products. Get personalized recommendations for smartwatches, fitness trackers, and wearables.">
    <meta name="robots" content="noindex, nofollow">

    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.verifyr.de/chat.html">
    <meta property="og:title" content="Verifyr Chat - Health-Tech Product Assistant">
    <meta property="og:description" content="Chat with our AI to compare smartwatches, fitness trackers, and health wearables.">
    <meta property="og:image" content="https://www.verifyr.de/images/og-image.png">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Verifyr Chat - Health-Tech Product Assistant">
    <meta name="twitter:description" content="Chat with our AI to compare smartwatches, fitness trackers, and health wearables.">

    <!-- Canonical -->
    <link rel="canonical" href="https://www.verifyr.de/chat.html">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="images/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="images/favicon-192x192.png">

    <!-- Google Analytics 4 -->
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      // Check consent from localStorage
      const savedConsent = localStorage.getItem('verifyr-consent');
      let analyticsAllowed = false;
      if (savedConsent) {
        try {
          const consentState = JSON.parse(savedConsent);
          analyticsAllowed = consentState.analytics === true;
        } catch (e) {}
      }

      gtag('consent', 'default', {
        'analytics_storage': analyticsAllowed ? 'granted' : 'denied'
      });
    </script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1ZT0DR8VL1"></script>
    <script>
      gtag('config', 'G-1ZT0DR8VL1', {
        'anonymize_ip': true,
        'page_title': 'Chat Interface'
      });
    </script>

    <!-- Prevent caching for auth pages -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <!-- Design System CSS -->
    <link rel="stylesheet" href="design-system/design-system.css">

    <!-- Chat-specific styles -->
    <link rel="stylesheet" href="styles.css">

    <!-- Hide content until auth check completes -->
    <style>
        body.auth-checking { visibility: hidden; }
    </style>
</head>
<body class="auth-checking">
    <!-- Conversation Sidebar (Desktop) -->
    <aside class="conversation-sidebar" id="conversationSidebar">
        <div class="sidebar-header">
            <h2>Menu</h2>
            <button class="sidebar-close-btn" id="sidebarCloseBtn" onclick="toggleSidebar()">×</button>
        </div>

        <!-- Language Switch -->
        <div class="sidebar-section">
            <div class="sidebar-lang-switch">
                <span class="lang-option active" data-lang="de" onclick="switchLanguage('de')">DE</span>
                <span class="lang-option" data-lang="en" onclick="switchLanguage('en')">EN</span>
            </div>
        </div>

        <!-- Model Selector -->
        <div class="sidebar-section">
            <label for="sidebarModelSelector" class="sidebar-section-label">Model:</label>
            <select id="sidebarModelSelector" class="model-selector sidebar-model-selector" onchange="syncModelSelector(this, 'modelSelector')">
                <option value="claude-sonnet-4.5">Sonnet 4.5</option>
                <option value="claude-haiku-4.5">Haiku 4.5</option>
                <option value="gpt-5.1">GPT-5.1</option>
                <option value="gpt-5-mini" selected>GPT-5 Mini</option>
                <option value="gemini-2.5-flash">Gemini Flash</option>
                <option value="gemini-2.5-pro">Gemini Pro</option>
            </select>
        </div>

        <!-- Conversations Section -->
        <div class="sidebar-section sidebar-conversations-section">
            <div class="sidebar-conversations-header">
                <span class="sidebar-section-label">Konversationen</span>
                <button class="sidebar-new-conversation-btn" onclick="createNewConversation()">+</button>
            </div>
            <div class="conversations-list" id="conversationsList">
                <!-- Conversation items will be inserted by JavaScript -->
            </div>
        </div>

        <!-- User Section -->
        <div class="sidebar-section sidebar-user-section">
            <span class="sidebar-user-email" id="sidebarUserEmail"></span>
            <button class="sidebar-logout-btn" onclick="handleLogout()">Abmelden</button>
        </div>
    </aside>

    <div class="chat-container">
        <!-- Sidebar Toggle Button (Mobile) -->
        <button class="sidebar-toggle-btn" id="sidebarToggleBtn" onclick="toggleSidebar()">
            ☰
        </button>

        <!-- Header -->
        <header class="chat-header">
            <div class="header-top">
                <!-- Mobile: Hamburger button (left side) -->
                <button class="hamburger-btn mobile-nav" aria-label="Menu">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>

                <div class="header-logo-section">
                    <a href="index.html" class="logo" style="text-decoration: none;">Verifyr</a>
                    <!-- Language Switcher (hidden on desktop, moved to sidebar) -->
                    <div class="lang-switch">
                        <span class="lang-option active" data-lang="de" onclick="switchLanguage('de')">DE</span>
                        <span class="lang-option" data-lang="en" onclick="switchLanguage('en')">EN</span>
                    </div>
                </div>

                <!-- Desktop: Navigation buttons (like quiz pages) -->
                <div class="header-nav desktop-nav">
                    <a href="/" class="nav-btn">Home</a>
                    <a href="/quiz/category.html" class="nav-btn">Quiz</a>
                    <a href="/chat.html" class="nav-btn active">Chat</a>
                </div>

                <!-- Controls: Model Selection & User Menu (hidden on desktop) -->
                <div class="header-controls">
                    <!-- Model Selector -->
                    <select id="modelSelector" class="model-selector" onchange="updateModelNote()">
                        <option value="claude-sonnet-4.5">Claude Sonnet 4.5</option>
                        <option value="claude-haiku-4.5">Claude Haiku 4.5</option>
                        <option value="gpt-5.1">GPT-5.1</option>
                        <option value="gpt-5-mini" selected>GPT-5 Mini</option>
                        <option value="gemini-2.5-flash">Gemini 2.5 Flash</option>
                        <option value="gemini-2.5-pro">Gemini 2.5 Pro</option>
                    </select>
                    <!-- User Menu -->
                    <div class="user-menu">
                        <button class="logout-btn" onclick="handleLogout()">
                            Abmelden
                        </button>
                        <span class="user-email" id="userEmail"></span>
                    </div>
                </div>
            </div>

            <!-- Mobile: Dropdown menu -->
            <div class="mobile-menu" id="chatMobileMenu">
                <!-- Language switch in mobile menu -->
                <div class="mobile-lang-switch">
                    <span class="lang-option active" data-lang="de" onclick="switchLanguage('de')">DE</span>
                    <span class="lang-option" data-lang="en" onclick="switchLanguage('en')">EN</span>
                </div>
                <div class="mobile-menu-divider"></div>

                <!-- Model Selector -->
                <div class="mobile-model-selector">
                    <label for="mobileModelSelector">Model:</label>
                    <select id="mobileModelSelector" class="model-selector" onchange="syncModelSelector(this, 'modelSelector')">
                        <option value="claude-sonnet-4.5">Sonnet 4.5</option>
                        <option value="claude-haiku-4.5">Haiku 4.5</option>
                        <option value="gpt-5.1">GPT-5.1</option>
                        <option value="gpt-5-mini" selected>GPT-5 Mini</option>
                        <option value="gemini-2.5-flash">Gemini Flash</option>
                        <option value="gemini-2.5-pro">Gemini Pro</option>
                    </select>
                </div>
                <div class="mobile-menu-divider"></div>

                <a href="/" class="mobile-menu-item">Home</a>
                <a href="/quiz/category.html" class="mobile-menu-item">Quiz</a>
                <a href="/chat.html" class="mobile-menu-item active">Chat</a>
                <div class="mobile-menu-divider"></div>

                <!-- Conversation History -->
                <div class="mobile-conversations">
                    <div class="mobile-conversations-header">
                        <h3>Konversationen</h3>
                        <button class="mobile-new-conversation-btn" onclick="createNewConversation(); closeMobileMenu();">+</button>
                    </div>
                    <div class="mobile-conversations-list" id="mobileConversationsList">
                        <!-- Conversation items will be inserted by JavaScript -->
                    </div>
                </div>
                <div class="mobile-menu-divider"></div>

                <!-- User info and logout -->
                <div class="mobile-user-info">
                    <span class="mobile-user-email" id="mobileUserEmail"></span>
                    <button class="mobile-logout-btn" onclick="handleLogout()">Abmelden</button>
                </div>
            </div>

            <div class="hero-badge-container">
                <div class="hero-badge" id="heroBadge">Dein intelligenter Health-Tech Shopping-Berater</div>
            </div>
        </header>

        <!-- Chat Messages Area -->
        <div class="chat-messages" id="chatMessages">
            <!-- Welcome message will be inserted by JavaScript -->
        </div>

        <!-- Quick Reply Buttons (dynamically generated by JavaScript) -->
        <div class="quick-replies" id="quickReplies">
            <!-- Buttons will be generated by updateQuickReplies() -->
        </div>

        <!-- Input Area -->
        <div class="chat-input-area">
            <div class="chat-input-container">
                <input
                    type="text"
                    id="chatInput"
                    class="chat-input"
                    placeholder="Frag nach Produkteigenschaften..."
                    autocomplete="off"
                >
                <button id="sendButton" class="submit-btn" disabled>
                    <span class="send-text">Senden</span>
                    <span class="loading" style="display: none;"></span>
                </button>
            </div>
            <p class="input-note" id="inputNote" data-i18n="input.note">Enter zum Senden • Powered by GPT-4o Mini</p>
        </div>

        <!-- Footer -->
        <footer class="chat-footer">
            <p>BETA - Die KI kann Fehler machen, überprüfe wichtige Informationen</p>
        </footer>
    </div>

    <!-- Supabase JS SDK for authentication -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Auth Modal Component -->
    <link rel="stylesheet" href="/components/auth-modal.css">
    <script src="/components/auth-modal.js"></script>

    <!-- Language initialization -->
    <script>
        // Set initial language from localStorage
        window.currentLanguage = localStorage.getItem('verifyr-lang') || 'de';
    </script>

    <script src="app.js"></script>

    <!-- ========================================
         CODE PROTECTION
         Discourages casual code copying while maintaining professional UX
         ======================================== -->
    <script>
        (function() {
            // 1. Disable right-click to prevent easy access to "View Source"
            document.addEventListener('contextmenu', e => {
                e.preventDefault();
                console.log('Right-click disabled. © 2026 Verifyr');
            });

            // 2. Disable common DevTools keyboard shortcuts
            document.addEventListener('keydown', e => {
                // F12 - DevTools
                if (e.key === 'F12') {
                    e.preventDefault();
                    return false;
                }

                // Ctrl+Shift+I - Inspect Element
                if (e.ctrlKey && e.shiftKey && e.key === 'I') {
                    e.preventDefault();
                    return false;
                }

                // Ctrl+Shift+J - Console
                if (e.ctrlKey && e.shiftKey && e.key === 'J') {
                    e.preventDefault();
                    return false;
                }

                // Ctrl+U - View Source
                if (e.ctrlKey && e.key === 'u') {
                    e.preventDefault();
                    return false;
                }
            });

            // 3. Professional console message for curious developers
            const styles = {
                title: 'font-size:20px;font-weight:bold;color:#3B82F6;',
                text: 'font-size:14px;color:#0F172A;',
                link: 'font-size:14px;color:#64748B;',
                copyright: 'font-size:12px;color:#2563eb;font-weight:600;'
            };

            console.log('%cVerifyr - AI Shopping Assistant', styles.title);
            console.log('%cBuilt with FastAPI, Claude Code in Cursor, and Qdrant Vector DB for RAG', styles.text);
            console.log('%cBy Prabhav Mhapne | https://linkedin.com/in/prabhavmhapne', styles.link);
            console.log('%c© 2026 All rights reserved.', styles.copyright);

            // 4. Disable text selection on code elements (preserves UX for content)
            document.querySelectorAll('script, style').forEach(el => {
                if (el.style) el.style.userSelect = 'none';
            });
        })();
    </script>
</body>
</html>
